rule "newHeatingRoomTemp"
when
    Item MODHeizTemp changed
then
        val Number newValue = MODHeizTemp.state as Number
        newValue = newValue/10
        //logInfo("HeizungsraumTemp", "new value: {}", newValue)
        HeizungsraumTemp.postUpdate(newValue)
end

rule "calcHeatRoom"
when 
       Item MODHeizHum changed
then
        val Number newValue = MODHeizHum.state as Number
	if (newValue >8192) 
	{
	newValue = newValue-8192
	}
	if (newValue >4096) 
	{
	newValue = newValue-4096
	}

	if (newValue >2048) 
	{
	newValue = newValue-2048
	}

        newValue = newValue/10
        //logInfo("HeizungsraumHum", "new value: {}", newValue)

        HeizungsraumHum.postUpdate(newValue)

end


rule "Oel Verbrauch"

 
when
	Time cron "0 0/1 * * * ?" //every 1 Minute for DEBUG !!!
//	Time cron"0 0/5 * * * ?" //every 5 Minutes
then

	//logInfo("ZonedDateTime.now()", "ZonedDateTime.now(): " + ZonedDateTime.now())
	//logInfo("LocalTime.MIDNIGHT", "LocalTime.MIDNIGHT " + LocalTime.MIDNIGHT)
	//logInfo("LocalTime.MIDNIGHT", "LocalTime.MIDNIGHT " + MODOil.maximumSince(now.minusHours(24)).state)
	//logInfo("delat", "deltaT " + MODOil.deltaSince(ZonedDateTime.now().with(LocalTime.MIDNIGHT)))


	//logInfo("delat", "deltaT " + MODOil.persistedState(now.minusDays(1)))


	val Number minimum =  MODOil.minimumSince(now.minusHours(24)).state as Number
	val Number maximum = MODOil.maximumSince(now.minusHours(24)).state as Number
	//val Number daily = MODOil.state as Number
	val Number daily = MODOil.deltaSince(ZonedDateTime.now().with(LocalTime.MIDNIGHT)) as Number


	val Number current = MODOil.state as Number
	//logInfo("calc OiL", "min Oil: " + minimum)
	//logInfo("calc Oil", "max Oil: " + maximum)
	val day = maximum-minimum

	//convertion to liter
	// set digits after decimal point
	day = day.intValue/1000.0
	daily = daily.intValue/1000.0
	current = current.intValue/1000.0

	logInfo("calc Oil", "last day Oil: " + day + " l")
	logInfo("calc Oil", "   daily Oil: " + daily + " l")
	logInfo("calc Oil", " summary Oil: " + current + " l")
		
	OilDay.
	postUpdate(day)
	OilDaily.
	postUpdate(daily)
	Oil.
	postUpdate(current)
end